---
import fs from 'fs';
import Layout from "../layouts/Layout.astro";
import Card from "../components/Card.astro";
import CardAvis from "../components/CardAvis.astro";

let defaultEnd;
try {
	// read the countdown end written at deploy/build time to public/countdown.json
	const p = new URL('../../public/countdown.json', import.meta.url);
	const raw = fs.readFileSync(p, 'utf-8');
	const parsed = JSON.parse(raw);
	if (parsed && parsed.end) defaultEnd = parsed.end;
} catch (e) {
	// fallback: 48h from build time
	defaultEnd = new Date(Date.now() + 48 * 60 * 60 * 1000).toISOString();
}
---

<Layout>
	<section
		class="relative bg-cover bg-center bg-no-repeat min-h-screen"
		style="background-image: url('/image-1.webp');"
	>
		<div
			id="hero"
			data-end={defaultEnd}
			class="min-h-screen flex items-center"
		>
			<div class="max-w-4xl mx-auto text-center py-28 px-6">
				<h1 class="text-white text-xl lg:text-2xl">
					L'élégance naturelle. <span class="block p-2"
						>L'offre exceptionnelle.</span
					>
				</h1>
				<h2 class="text-[#FEF3C6] text-lg lg:text-xl mt-4">
					Montres en bois éco-conçues — jusqu'à -40 % pendant 48h
					seulement.
				</h2>

				<div
					class="mt-8 inline-flex items-center gap-4 bg-white/5 rounded-full px-4 py-3"
				>
					<div class="text-center px-3">
						<div
							id="cd-days"
							class="text-2xl font-semibold text-white"
						>
							<span
								class="bg-[#ff7a0a] text-white px-3 py-1 rounded-md inline-block"
								>--</span
							>
						</div>
						<div class="text-xs text-gray-300">Jours</div>
					</div>
					<div class="text-center px-3">
						<div
							id="cd-hours"
							class="text-2xl font-semibold text-white"
						>
							<span
								class="bg-[#ff7a0a] text-white px-3 py-1 rounded-md inline-block"
								>--</span
							>
						</div>
						<div class="text-xs text-gray-300">Heures</div>
					</div>
					<div class="text-center px-3">
						<div
							id="cd-mins"
							class="text-2xl font-semibold text-white"
						>
							<span
								class="bg-[#ff7a0a] text-white px-3 py-1 rounded-md inline-block"
								>--</span
							>
						</div>
						<div class="text-xs text-gray-300">Minutes</div>
					</div>
					<div class="text-center px-3">
						<div
							id="cd-secs"
							class="text-2xl font-semibold text-white"
						>
							<span
								class="bg-[#ff7a0a] text-white px-3 py-1 rounded-md inline-block"
								>--</span
							>
						</div>
						<div class="text-xs text-gray-300">Secondes</div>
					</div>
				</div>

				<div class="mt-6">
					<a
						id="cta-btn"
						href="#"
						class="inline-block bg-[#ff7a0a] text-white px-6 py-3 rounded-full"
						>J'en profite maintenant</a
					>
				</div>

				<p class="sr-only" id="cd-live" aria-live="polite">
					Décompte en cours
				</p>
			</div>

			<!-- Scroll indicator (souris) animé -->
			<a
				href="#below-fold"
				class="absolute left-1/2 -translate-x-1/2 bottom-24 lg:bottom-18 flex items-center justify-center"
				aria-label="Aller au contenu"
			>
				<span
					class="w-6 h-10 rounded-[20px] border-2 border-[#ff7a0a] flex items-center justify-center p-2"
				>
					<span
						class="w-1 h-3 bg-[#ff7a0a] rounded-full"
						style="animation: scrollBounce 3s infinite ease-in-out;"
					></span>
				</span>
			</a>
		</div>
	</section>

	<!-- Produits en vedette -->
	<section id="below-fold" class="py-16 bg-white">
		<div class="max-w-7xl mx-auto px-6">
			<h2 class="text-center text-gray-700 text-sm font-medium">
				Nos Modèles Phares
			</h2>
			<p class="text-center text-gray-500 text-sm mt-2 mb-8">
				Chaque montre est une pièce unique, assemblée à la main en
				France.
			</p>

			<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
				<Card
					title="Bois clair"
					image="/montre-1.webp"
					price="99€"
					oldPrice="149€"
				/>
				<Card
					title="Noyer"
					image="/montre-2.webp"
					price="99€"
					oldPrice="169€"
					badge="Best-seller"
				/>
				<Card
					title="Ébène"
					image="/montre-3.webp"
					price="109€"
					oldPrice="179€"
				/>
				<Card
					title="Bambou"
					image="/montre-4.webp"
					price="95€"
					oldPrice="159€"
				/>
			</div>
		</div>
	</section>

	<!-- Features: éco-responsable / design / fabrication locale -->
	<section class="bg-[#0b0b0b] text-gray-200 py-16">
		<div class="max-w-7xl mx-auto px-6">
			<div
				class="grid grid-cols-1 md:grid-cols-3 gap-8 items-start text-center"
			>
				<div class="flex flex-col items-center">
					<div
						class="w-16 h-16 rounded-full bg-black/40 flex items-center justify-center mb-4"
					>
						<!-- leaf icon -->
						<img src="/Icon.svg" alt="" />
					</div>
					<h3 class="text-white font-semibold text-sm">
						Éco-responsable
					</h3>
					<p class="text-sm text-gray-400 mt-2 max-w-xs">
						Bois issu de forêts gérées durablement.
					</p>
				</div>

				<div class="flex flex-col items-center">
					<div
						class="w-16 h-16 rounded-full bg-black/40 flex items-center justify-center mb-4"
					>
						<!-- watch icon -->
						<img src="/watch-outline-rounded.svg" alt="" />
					</div>
					<h3 class="text-white font-semibold text-sm">
						Design unique
					</h3>
					<p class="text-sm text-gray-400 mt-2 max-w-xs">
						Chaque montre est une pièce originale.
					</p>
				</div>

				<div class="flex flex-col items-center">
					<div
						class="w-16 h-16 rounded-full bg-black/40 flex items-center justify-center mb-4"
					>
						<!-- location icon -->
						<img src="/Icon-map.svg" alt="" />
					</div>
					<h3 class="text-white font-semibold text-sm">
						Fabrication locale
					</h3>
					<p class="text-sm text-gray-400 mt-2 max-w-xs">
						Assemblée à la main en France.
					</p>
				</div>
			</div>
		</div>
	</section>

	<!-- Collection CTA: image avec overlay sombre + texte centré + bouton -->
	<section class="relative bg-cover bg-center bg-no-repeat">
		<img
			src="/image-2.webp"
			alt="Montre en bois"
			class="w-full h-auto object-contain block"
		/>
		<div class="absolute inset-0 bg-black/30"></div>
		<div class="absolute inset-0 flex items-center justify-center">
			<div class="max-w-3xl text-center px-6 py-24 md:py-32 lg:py-40">
				<p class="text-sm text-white/80 mb-4">
					Alliez élégance, éthique et performance.
				</p>
				<p
					class="text-white text-base md:text-lg lg:text-xl font-medium mb-6"
				>
					Nos montres s'adaptent à tous les styles — du quotidien à
					l'exceptionnel.
				</p>
				<a
					href="#"
					class="inline-block bg-white text-gray-800 rounded-full px-6 py-2 text-sm font-semibold"
					>Découvrir la collection</a
				>
			</div>
		</div>
	</section>
	
	<!-- Témoignages clients -->
	<section class="py-12 bg-gray-50">
		<div class="max-w-7xl mx-auto px-6 text-center">
			<p class="text-lg text-[#1C1917]">Ce que disent nos clients</p>
			<p class="text-md text-[#57534D] mt-2 mb-8">Des centaines d'avis positifs pour des montres uniques.</p>
			<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
				<CardAvis note={5} avis={"Une montre légère et magnifique, parfaite pour offrir !"} auteur={"Marie L."} />
				<CardAvis note={4} avis={"Un design unique, et en plus éco-responsable."} auteur={"Thomas P."} />
				<CardAvis note={5} avis={"Livraison rapide, packaging soigné. J'adore !"} auteur={"Léa G."} />
			</div>
		</div>
	</section>
	
	<!-- Section promotionnelle dégradé diagonal -->
	<section class="relative">
		<div class="w-full" style="background: linear-gradient(135deg, #E17100 0%, #BB4D00 50%, #7B3306 100%);">
			<div class="max-w-3xl mx-auto text-center px-6 py-12 md:py-16 lg:py-20">
				<p class="text-xs lg:text-lg text-white/90 mb-8">Offre Black Friday : jusqu'à -40 % sur toute la collection !</p>
				<p class="text-[#FEF3C6] text-base md:text-md lg:text-xl font-medium mb-10">Profitez-en avant minuit ce soir.</p>
				<div class="flex flex-col items-center gap-4">
					<a href="#" class="inline-block bg-black/80 text-white lg:text-sm px-8 py-3 rounded-full shadow-lg mb-8">Je commande avant la fin de la promo</a>
					<a href="#" class="inline-block border border-white/30 text-white lg:text-md px-6 py-3 rounded-md bg-[#FFFFFF]/20">Livraison gratuite + coffret cadeau offert !</a>
				</div>
			</div>
		</div>
	</section>

	
	<!-- Section: images côte-à-côte + texte centré -->
	<section class="py-12 bg-white">
		<div class="max-w-7xl mx-auto px-6">
			<div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
				<img src="/image-3.webp" alt="Forêt" class="w-full h-auto object-cover block" />
				<img src="/image-4.webp" alt="Fabrication" class="w-full h-auto object-cover block" />
			</div>
			<div class="mt-6 text-center">
				<p class="text-xs text-gray-600">Nos montres soutiennent une production locale et durable.</p>
				<p class="text-sm text-gray-500 mt-3">Chaque achat contribue à la reforestation et à la préservation des savoir-faire artisanaux.</p>
			</div>
		</div>
	</section>

	<script type="module">
		// Read server-side date from hero data attribute and run countdown after DOM ready
		let endDate = null;
		function resolveEndDate() {
			const heroEl = document.getElementById("hero");
			if (heroEl && heroEl.dataset && heroEl.dataset.end) {
				const d = new Date(heroEl.dataset.end);
				if (!isNaN(d)) return d;
			}
			// fallback: 48h from now
			return new Date(Date.now() + 48 * 60 * 60 * 1000);
		}

		function pad(n) {
			return String(n).padStart(2, "0");
		}

		function initCountdown() {
			const $days = document.getElementById("cd-days");
			const $hours = document.getElementById("cd-hours");
			const $mins = document.getElementById("cd-mins");
			const $secs = document.getElementById("cd-secs");
			const $live = document.getElementById("cd-live");
			const $cta = document.getElementById("cta-btn");

			if (!$days || !$hours || !$mins || !$secs) return;

			let timer = null;
			endDate = resolveEndDate();

			function update() {
				const now = new Date();
				let diff = Math.max(0, endDate - now);

				const days = Math.floor(diff / (24 * 60 * 60 * 1000));
				diff -= days * 24 * 60 * 60 * 1000;
				const hours = Math.floor(diff / (60 * 60 * 1000));
				diff -= hours * 60 * 60 * 1000;
				const mins = Math.floor(diff / (60 * 1000));
				diff -= mins * 60 * 1000;
				const secs = Math.floor(diff / 1000);

				// Mettre à jour les spans internes pour conserver le style bg-orange
				if ($days) {
					const s = $days.querySelector("span");
					if (s) s.textContent = days;
					else $days.textContent = days;
				}
				if ($hours) {
					const s = $hours.querySelector("span");
					if (s) s.textContent = pad(hours);
					else $hours.textContent = pad(hours);
				}
				if ($mins) {
					const s = $mins.querySelector("span");
					if (s) s.textContent = pad(mins);
					else $mins.textContent = pad(mins);
				}
				if ($secs) {
					const s = $secs.querySelector("span");
					if (s) s.textContent = pad(secs);
					else $secs.textContent = pad(secs);
				}
				if ($live)
					$live.textContent = `Temps restant : ${days} jours ${pad(hours)} heures ${pad(mins)} minutes ${pad(secs)} secondes`;

				if (days === 0 && hours === 0 && mins === 0 && secs === 0) {
					clearInterval(timer);
					if ($live) $live.textContent = "Offre terminée";
					if ($cta) {
						$cta.classList.add("opacity-50", "pointer-events-none");
						$cta.textContent = "Offre terminée";
					}
				}
			}

			update();
			timer = setInterval(update, 1000);
		}

		if (document.readyState === "loading") {
			document.addEventListener("DOMContentLoaded", initCountdown);
		} else {
			initCountdown();
		}
	</script>

	<style>
		@keyframes scrollBounce {
			0%,
			100% {
				transform: translateY(0);
			}
			50% {
				transform: translateY(8px);
			}
		}
	</style>
</Layout>
